# name: test/sql/adbc_execute.test
# description: test adbc_execute function for DDL/DML statements
# group: [adbc]

require adbc_scanner

require-env HAS_ADBC_SQLITE_DRIVER

statement ok
SET VARIABLE conn_id = (SELECT adbc_connect({'driver': 'sqlite', 'uri': ':memory:'}));

# Test CREATE TABLE
query I
SELECT adbc_execute(getvariable('conn_id')::BIGINT, 'CREATE TABLE exec_test (id INTEGER PRIMARY KEY, name TEXT)');
----
0

# Test INSERT
query I
SELECT adbc_execute(getvariable('conn_id')::BIGINT, 'INSERT INTO exec_test VALUES (1, ''hello''), (2, ''world'')');
----
0

# Verify data was inserted
query II
SELECT * FROM adbc_scan(getvariable('conn_id')::BIGINT, 'SELECT * FROM exec_test ORDER BY id');
----
1	hello
2	world

# Test UPDATE
query I
SELECT adbc_execute(getvariable('conn_id')::BIGINT, 'UPDATE exec_test SET name = ''updated'' WHERE id = 1');
----
0

# Verify update worked
query II
SELECT * FROM adbc_scan(getvariable('conn_id')::BIGINT, 'SELECT * FROM exec_test WHERE id = 1');
----
1	updated

# Test DELETE
query I
SELECT adbc_execute(getvariable('conn_id')::BIGINT, 'DELETE FROM exec_test WHERE id = 2');
----
0

# Verify delete worked
query I
SELECT COUNT(*) FROM adbc_scan(getvariable('conn_id')::BIGINT, 'SELECT * FROM exec_test');
----
1

# Test adbc_execute with invalid connection handle
statement error
SELECT adbc_execute(12345, 'SELECT 1');
----
Invalid Input Error: adbc_execute: Invalid connection handle: 12345

# Clean up
statement ok
SELECT adbc_disconnect(getvariable('conn_id')::BIGINT);
